(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("nanoid")):typeof define=="function"&&define.amd?define(["exports","nanoid"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s["vue-validate-form"]={},s.nanoid))})(this,function(s,l){"use strict";const y={};function F(e,t){y[e]=t}const h=Symbol("hasFieldValue"),n=Symbol("getFieldValue"),o=Symbol("getFieldDefaultValue"),p=Symbol("getErrors"),u=Symbol("register"),g=Symbol("validate"),f=Symbol("getIsSubmitted");var S=Object.freeze(Object.defineProperty({__proto__:null,hasFieldValue:h,getFieldValue:n,getFieldDefaultValue:o,getErrors:p,register:u,validate:g,getIsSubmitted:f},Symbol.toStringTag,{value:"Module"}));function c(e,t=null){return e.$scopedSlots.default?e.$scopedSlots.default(t)||[]:e.$slots.default||[]}function b(e,t){if(!m(e))return!1;let r=t.split(".");for(;r.length;){const i=r.shift();if(!(i in e))return!1;e=e[i]}return!0}function v(e,t,r){if(!m(e))return r;let i=t.split(".");for(;i.length&&e;){const a=i.shift();e=e[a]}return i.length?r:e}function D(e,t,r){if(!m(e))return;let i=t.split(".");for(;i.length>1;){const a=i.shift();m(e[a])||(e[a]=O(i[0])?[]:{}),e=e[a]}e[i[0]]=r}function O(e){const t=Number(e);return!Number.isNaN(t)}function m(e){return!!e&&typeof e=="object"}var k={name:"ValidationProvider",provide(){return{[u]:this.register,[g]:async e=>{if(this.validateField(e),!this.resolver)return;const{errors:t}=await this.resolver(this.values);Object.entries(t).forEach(([r,{message:i,type:a}])=>{this.setError(r,i,a)})},[o]:this.getFieldDefaultValue,[n]:e=>v(this.values,e),[p]:this.getErrors,[h]:e=>b(this.values,e),[f]:()=>this.submitted}},props:{defaultValues:{type:Object,default:()=>({})},resolver:{type:Function,default:null},tag:{type:String,default:"div"}},data(){return{submitted:!1,innerDefaultValues:{},callbacks:[],additionalErrors:{}}},computed:{callbackDataMap(){return this.callbacks.reduce((e,t)=>{const r=t();return e[r.name]=r,e},{})},values(){return Object.entries(this.callbackDataMap).reduce((e,[t,{value:r}])=>(D(e,t,r),e),{})},dirty(){return Object.values(this.callbackDataMap).some(({dirty:e})=>e)},errors(){return Object.values(this.callbackDataMap).reduce((e,{errors:t,name:r})=>(e[r]=t,e),Object.assign({},this.additionalErrors))},existsErrors(){return Object.values(this.errors).some(e=>e.length)},firstInvalidFieldData(){return Object.values(this.callbackDataMap).find(({name:e})=>this.errors[e].length)}},watch:{defaultValues:{immediate:!0,handler(e){this.reset(e)}},dirty:{immediate:!0,handler(e){this.$emit("dirty",e)}}},methods:{getFieldDefaultValue(e,t){return v(this.innerDefaultValues,e,t)},getErrors(e){return e?this.errors[e]||[]:this.errors},validateField(e){const{rules:t,value:r,setError:i,resetErrors:a}=this.callbackDataMap[e];a(),Object.entries(t).forEach(([d,E])=>{const V=y[d];if(!V)throw new Error(`validator '${d}' must be registered`);V(r,E.params)||i(E.message,d)})},async onSubmit(){this.submitted=!0;let e=this.values;if(this.additionalErrors={},Object.keys(this.callbackDataMap).forEach(t=>{this.validateField(t)}),this.resolver){const{values:t,errors:r}=await this.resolver(this.values);e=t,Object.entries(r).forEach(([i,{message:a,type:d}])=>{this.setError(i,a,d)})}if(this.existsErrors)return this.focusInvalidField();this.$emit("submit",e,{setError:this.setError,reset:this.reset,focusInvalidField:this.focusInvalidField})},reset(e){this.submitted=!1,e&&(this.innerDefaultValues=JSON.parse(JSON.stringify(e))),Object.values(this.callbackDataMap).forEach(({reset:t})=>{t()})},setError(e,t,r=null){const i=this.callbackDataMap[e];if(i){i.setError(t,r);return}this.additionalErrors[e]===void 0&&this.$set(this.additionalErrors,e,[]),this.additionalErrors[e].push({type:r,message:t})},focusInvalidField(){return this.firstInvalidFieldData&&this.firstInvalidFieldData.focus()},register(e){const{name:t,setError:r}=e();return(this.additionalErrors[t]||[]).forEach(i=>{r(i)}),this.$delete(this.additionalErrors,t),this.callbacks.push(e),()=>this.unregister(e)},unregister(e){this.callbacks=this.callbacks.filter(t=>t!==e)}},render(e){const t=c(this,{handleSubmit:this.onSubmit,reset:this.reset,values:this.values,dirty:this.dirty,invalid:this.submitted&&this.existsErrors,errors:this.errors});return t.length<=1?t[0]:e(this.tag,t)}},$={name:"ValidationField",inject:{hasFieldValue:h,getFieldDefaultValue:o,getFieldValue:n,getIsSubmitted:f,register:u,validate:g},data(){return{value:void 0,errors:[]}},props:{name:{type:String,required:!0},rules:{type:Object,default:()=>({})},tag:{type:String,default:"div"}},computed:{defaultValue(){return this.getFieldDefaultValue(this.name)},hasProvidedValue(){return this.hasFieldValue(this.name)},providedValue(){return this.getFieldValue(this.name)},submitted(){return this.getIsSubmitted()},dirty(){return this.value!==this.defaultValue},firstError(){return this.errors[0]},invalid(){return this.submitted&&!!this.errors.length}},mounted(){this.value=this.hasProvidedValue?this.providedValue:this.defaultValue,this.unregister=this.register(this.fieldData)},beforeDestroy(){this.unregister()},methods:{fieldData(){return{name:this.name,value:this.value,dirty:this.dirty,errors:this.errors,rules:this.rules,focus:this.onFocus,reset:this.reset,setError:this.setError,resetErrors:this.resetErrors}},onFocus(){this.$emit("should-focus",{name:this.name})},reset(){this.resetErrors(),this.$nextTick(()=>{this.value=this.defaultValue})},onChange(e){this.value=e,this.submitted&&this.validate(this.name)},setError(e,t=null){this.errors.push({type:t,message:e})},resetErrors(){this.errors=[]}},render(e){const t=c(this,{name:this.name,onChange:this.onChange,setError:this.setError,modelValue:this.value,errors:this.errors,firstError:this.firstError,dirty:this.dirty,invalid:this.invalid});return t.length<=1?t[0]:e(this.tag,t)}},N={name:"ValidationFieldArray",inject:{register:u,getFieldDefaultValue:o,getFieldValue:n},provide(){return{[h]:e=>b(this.fields,e.replace(new RegExp(`^${this.name}.`),"")),[n]:e=>v(this.fields,e.replace(new RegExp(`^${this.name}.`),"")),[u]:e=>{if(this.focusOptions){const{focusName:t}=this.focusOptions,{focus:r,name:i}=e();i===t&&(r(),this.focusOptions=null)}return this.register(e)}}},data(){return{fields:[],focusOptions:null}},props:{name:{type:String,required:!0},keyName:{type:String,default:"id"},tag:{type:String,default:"div"}},computed:{defaultValue(){return this.getFieldDefaultValue(this.name)||[]},actualValue(){const e=this.keyName,t=this.getFieldValue(this.name)||[];return this.fields.map((r,i)=>({...t[i],[e]:r[e]}))}},mounted(){this.fields=[...this.defaultValue],this.unregister=this.register(this.fieldData)},beforeDestroy(){this.unregister()},methods:{fieldData(){return{name:this.name,value:[],dirty:!1,errors:[],rules:{},focus:this.noop,reset:this.reset,setError:this.noop,resetErrors:this.noop}},noop(){},reset(){this.fields=[...this.defaultValue]},append(e,t=null){var r;e[this.keyName]=(r=e[this.keyName])!=null?r:l.nanoid(),this.focusOptions=t,this.fields.push(e)},prepend(e,t=null){var r;e[this.keyName]=(r=e[this.keyName])!=null?r:l.nanoid(),this.focusOptions=t,this.fields.unshift(e)},insert(e,t,r=null){var i;t[this.keyName]=(i=t[this.keyName])!=null?i:l.nanoid(),this.focusOptions=r,this.fields.splice(e,0,t)},swap(e,t){const r=this.fields[e];this.$set(this.fields,e,this.fields[t]),this.$set(this.fields,t,r)},move(e,t){this.fields.splice(t,0,this.fields.splice(e,1)[0])},remove(e){this.fields=this.fields.filter((t,r)=>e!==r)}},render(e){const t=c(this,{name:this.name,fields:this.actualValue,append:this.append,prepend:this.prepend,insert:this.insert,swap:this.swap,move:this.move,remove:this.remove});return t.length<=1?t[0]:e(this.tag,t)}},w={name:"ValidationErrors",inject:{getErrors:p,getIsSubmitted:f},props:{name:{type:String,default:void 0},tag:{type:String,default:"div"}},computed:{submitted(){return this.getIsSubmitted()},errors(){const e=this.getErrors(this.name);return Array.isArray(e)?e:[].concat(...Object.values(e))},invalid(){return this.submitted&&!!this.errors.length}},render(e){if(!this.invalid)return;const t=c(this,{errors:this.errors});return t.length<=1?t[0]:e(this.tag,t)}};s.ValidationErrors=w,s.ValidationField=$,s.ValidationFieldArray=N,s.ValidationProvider=k,s.registerValidator=F,s.symbols=S,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
