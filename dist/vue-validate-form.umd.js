(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("nanoid")):typeof define=="function"&&define.amd?define(["exports","nanoid"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s["vue-validate-form"]={},s.nanoid))})(this,function(s,l){"use strict";const y={};function V(e,t){y[e]=t}const S=Symbol("addField"),D=Symbol("removeField"),k=Symbol("updateField"),O=Symbol("getFieldRegistered"),I=Symbol("setValue"),N=Symbol("setFieldError"),g=Symbol("getFieldErrors"),w=Symbol("getFieldDirty"),$=Symbol("getFieldInvalid"),o=Symbol("hasFieldValue"),d=Symbol("getFieldValue"),h=Symbol("getFieldDefaultValue"),n=Symbol("register"),p=Symbol("validate"),f=Symbol("getIsSubmitted");var M=Object.freeze(Object.defineProperty({__proto__:null,addField:S,removeField:D,updateField:k,getFieldRegistered:O,setValue:I,setFieldError:N,getFieldErrors:g,getFieldDirty:w,getFieldInvalid:$,hasFieldValue:o,getFieldValue:d,getFieldDefaultValue:h,register:n,validate:p,getIsSubmitted:f},Symbol.toStringTag,{value:"Module"}));function c(e,t=null){return e.$scopedSlots.default?e.$scopedSlots.default(t)||[]:e.$slots.default||[]}function F(e,t){if(!m(e))return!1;let i=t.split(".");for(;i.length;){const r=i.shift();if(!Object.hasOwn(e,r))return!1;e=e[r]}return!0}function v(e,t,i){if(!m(e))return i;let r=t.split(".");for(;r.length&&e;){const a=r.shift();e=e[a]}return r.length?i:e}function j(e,t,i){if(!m(e))return;let r=t.split(".");for(;r.length>1;){const a=r.shift();m(e[a])||(e[a]=P(r[0])?[]:{}),e=e[a]}e[r[0]]=i}function P(e){const t=Number(e);return!Number.isNaN(t)}function m(e){return!!e&&typeof e=="object"}var _={name:"ValidationProvider",provide(){return{[n]:this.register,[p]:async e=>{if(this.validateField(e),!this.resolver)return;const{errors:t}=await this.resolver(this.values);if(t[e]){const{setError:i}=this.callbackDataMap[e];i(t[e].message,t[e].type)}},[h]:this.getFieldDefaultValue,[d]:e=>v(this.values,e),[g]:this.getFieldErrors,[o]:e=>F(this.values,e),[f]:()=>this.submitted}},props:{defaultValues:{type:Object,default:()=>({})},resolver:{type:Function,default:null},tag:{type:String,default:"div"}},data(){return{submitted:!1,innerDefaultValues:{},callbacks:[],additionalErrors:{}}},computed:{callbackDataMap(){return this.callbacks.reduce((e,t)=>{const i=t();return e[i.name]=i,e},{})},values(){return Object.entries(this.callbackDataMap).reduce((e,[t,{value:i}])=>(j(e,t,i),e),{})},dirty(){return Object.values(this.callbackDataMap).some(({dirty:e})=>e)},errors(){return Object.values(this.callbackDataMap).reduce((e,{errors:t,name:i})=>(e[i]=t,e),Object.assign({},this.additionalErrors))},existsErrors(){return Object.values(this.errors).some(e=>e.length)},firstInvalidFieldData(){return Object.values(this.callbackDataMap).find(({name:e})=>this.errors[e].length)}},watch:{defaultValues:{immediate:!0,handler(e){this.reset(e)}},dirty:{immediate:!0,handler(e){this.$emit("dirty",e)}}},methods:{getFieldDefaultValue(e,t){return v(this.innerDefaultValues,e,t)},getFieldErrors(e){return this.errors[e]||[]},validateField(e){const{rules:t,value:i,setError:r,resetErrors:a}=this.callbackDataMap[e];a(),Object.entries(t).forEach(([u,b])=>{const E=y[u];if(!E)throw new Error(`validator '${u}' must be registered`);E(i,b.params)||r(b.message,u)})},async onSubmit(){this.submitted=!0;let e=this.values;if(this.additionalErrors={},Object.keys(this.callbackDataMap).forEach(t=>{this.validateField(t)}),this.resolver){const{values:t,errors:i}=await this.resolver(this.values);e=t,Object.entries(i).forEach(([r,{message:a,type:u}])=>{this.setError(r,a,u)})}if(this.existsErrors)return this.focusInvalidField();this.$emit("submit",e,{setError:this.setError,reset:this.reset,focusInvalidField:this.focusInvalidField})},reset(e){this.submitted=!1,e&&(this.innerDefaultValues=JSON.parse(JSON.stringify(e))),Object.values(this.callbackDataMap).forEach(({reset:t})=>{t()})},setError(e,t,i=null){const r=this.callbackDataMap[e];if(r){r.setError(t,i);return}this.additionalErrors[e]===void 0&&this.$set(this.additionalErrors,e,[]),this.additionalErrors[e].push({type:i,message:t})},focusInvalidField(){return this.firstInvalidFieldData&&this.firstInvalidFieldData.focus()},register(e){const{name:t,setError:i}=e();return(this.additionalErrors[t]||[]).forEach(r=>{i(r)}),this.$delete(this.additionalErrors,t),this.callbacks.push(e),()=>this.unregister(e)},unregister(e){this.callbacks=this.callbacks.filter(t=>t!==e)}},render(e){const t=c(this,{handleSubmit:this.onSubmit,reset:this.reset,values:this.values,dirty:this.dirty,invalid:this.submitted&&this.existsErrors,errors:this.errors});return t.length<=1?t[0]:e(this.tag,t)}},R={name:"ValidationField",inject:{hasFieldValue:o,getFieldDefaultValue:h,getFieldValue:d,getIsSubmitted:f,register:n,validate:p},data(){return{value:void 0,errors:[]}},props:{name:{type:String,required:!0},rules:{type:Object,default:()=>({})},tag:{type:String,default:"div"}},computed:{defaultValue(){return this.getFieldDefaultValue(this.name)},hasProvidedValue(){return this.hasFieldValue(this.name)},providedValue(){return this.getFieldValue(this.name)},submitted(){return this.getIsSubmitted()},dirty(){return this.value!==this.defaultValue},firstError(){return this.errors[0]},invalid(){return this.submitted&&!!this.errors.length}},mounted(){this.value=this.hasProvidedValue?this.providedValue:this.defaultValue,this.unregister=this.register(this.fieldData)},beforeDestroy(){this.unregister()},methods:{fieldData(){return{name:this.name,value:this.value,dirty:this.dirty,errors:this.errors,rules:this.rules,focus:this.onFocus,reset:this.reset,setError:this.setError,resetErrors:this.resetErrors}},onFocus(){this.$emit("should-focus",{name:this.name})},reset(){this.resetErrors(),this.value=this.defaultValue},onChange(e){this.value=e,this.submitted&&this.validate(this.name)},setError(e,t=null){this.errors.push({type:t,message:e})},resetErrors(){this.errors=[]}},render(e){const t=c(this,{name:this.name,onChange:this.onChange,setError:this.setError,modelValue:this.value,errors:this.errors,firstError:this.firstError,dirty:this.dirty,invalid:this.invalid});return t.length<=1?t[0]:e(this.tag,t)}},q={name:"ValidationFieldArray",inject:{register:n,getFieldDefaultValue:h,getFieldValue:d},provide(){return{[o]:e=>F(this.fields,e.replace(new RegExp(`^${this.name}.`),"")),[d]:e=>v(this.fields,e.replace(new RegExp(`^${this.name}.`),"")),[n]:e=>{if(this.shouldFocus){const{focus:t}=e();t(),this.shouldFocus=!1}return this.register(e)}}},data(){return{fields:[],shouldFocus:!1}},props:{name:{type:String,required:!0},keyName:{type:String,default:"id"},tag:{type:String,default:"div"}},computed:{defaultValue(){return this.getFieldDefaultValue(this.name)||[]},actualValue(){const e=this.keyName;return this.fields.map(t=>({[e]:t[e]}))}},mounted(){this.fields=[...this.defaultValue],this.unregister=this.register(this.fieldData)},beforeDestroy(){this.unregister()},methods:{fieldData(){return{name:this.name,value:JSON.parse(JSON.stringify(this.actualValue)),dirty:!1,errors:[],rules:{},focus:this.noop,reset:this.reset,setError:this.noop,resetErrors:this.noop}},noop(){},reset(){this.fields=[...this.defaultValue]},append(e,t=!1){var i;e[this.keyName]=(i=e[this.keyName])!=null?i:l.nanoid(),this.shouldFocus=t,this.fields.push(e)},prepend(e,t=!1){var i;e[this.keyName]=(i=e[this.keyName])!=null?i:l.nanoid(),this.shouldFocus=t,this.fields.unshift(e)},insert(e,t,i=!1){var r;t[this.keyName]=(r=t[this.keyName])!=null?r:l.nanoid(),this.shouldFocus=i,this.fields.splice(e,0,t)},swap(e,t){const i=this.fields[e];this.$set(this.fields,e,this.fields[t]),this.$set(this.fields,t,i)},move(e,t){this.fields.splice(t,0,this.fields.splice(e,1)[0])},remove(e){this.fields=this.fields.filter((t,i)=>e!==i)}},render(e){const t=c(this,{name:this.name,fields:this.actualValue,append:this.append,prepend:this.prepend,insert:this.insert,swap:this.swap,move:this.move,remove:this.remove});return t.length<=1?t[0]:e(this.tag,t)}},C={name:"ValidationErrors",inject:{getFieldErrors:g,getIsSubmitted:f},props:{name:{type:String,required:!0},tag:{type:String,default:"div"}},computed:{submitted(){return this.getIsSubmitted()},errors(){return this.getFieldErrors(this.name)},invalid(){return this.submitted&&!!this.errors.length}},render(e){if(!this.invalid)return;const t=c(this,{errors:this.errors});return t.length<=1?t[0]:e(this.tag,t)}};s.ValidationErrors=C,s.ValidationField=R,s.ValidationFieldArray=q,s.ValidationProvider=_,s.registerValidator=V,s.symbols=M,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
